# 버건디의 성
## 과제 개요
- 버건디의 성은 육각 타일을 놓아 왕국을 만들어나가는 게임입니다. 플레이어마다 개인판을 하나씩 가져가 자기 영지를 각자 운영하는 식으로 진행됩니다.
- 차례가 시작되면 각자 6면체 주사위 2개를 굴립니다. 주사위를 사용해서 할 수 있는 액션을 하나씩 진행합니다.
- 이 게임은 5개의 페이즈(A-E)로 이루어져있고 각 페이즈는 5라운드로 구성되어 있습니다.
- 버건디의 성 게임 설명
  - https://ko.boardgamearena.com/gamepanel?game=castlesofburgundy
  - [유튜브 설명](https://www.youtube.com/watch?v=pEOM8ZD49iw)

---

## 게임의 진행
### 각 페이즈를 준비합니다.
- 각 페이즈를 시작 할 때 남은 6각형의 타일을 모두 제거하여 박스에 넣습니다.
- 6각형의 타일을 무작위로 꺼내 여섯 군데의 눈금 칸 둥 타일과 일치하는 색깔의 칸에 앞면으로 놓습니다.
- 뒷면이 검은색인 6각형 타일을 무작위로 꺼내 게임 보드의 중앙의 검은색 칸 앞면으로 놓습니다.(플레이어의 수에 따라 2~8개 꺼냄).
- 현재 페이즈에 해당하는 상품 타일 5개를 해당 페이즈의 아래에 있는 라운드 칸에 놓습니다.(4각형, 총 5칸)

### 다섯 번의 게임 라운드
- 모든 플레이어는 주사위를 동시에 굴립니다.
- 시작 플레이어는 흰색 주사위도 굴립니다.
- 시작 플레이어부터 진행합니다. 라운드 칸의 맨 위에 있는 상품타일을 흰색 주사위 눈금과 일치하는 눈금 칸의 상품칸에 놓습니다.
- 이후 시작 플레이어는 자신의 턴을 수행합니다. 턴 순서대로 다음 플레이어가 턴을 수행합니다(턴 순서 트랙의 오른쪽에서 왼쪽 순으로, 해당하는 타워의 위에서 아래로)
- 모든 플레이어가 턴을 수행하면 새로운 라운드를 시작합니다.

### 플레이어의 턴
- 플레이어의 턴은 주사위 하나당 액션 1가지입니다. 라운드 당 액션 2번을 수행합니다.
- 일꾼 타일 : 이 타일은 언제든지 사용 가능하며, 자신이 굴린 주사위 눈금이 +-1을 할 수 있습니다.(1->6, 6->1도 포함합니다.) 여러 개를 중복해서 사용이 가능합니다.

### 액션
- 게임 보드에서 6각형 타일 받기 : 게임 보드에서 해당 영역과 일치하는 주사위를 사용해 타일을 한개 받습니다. 이 타일은 좌하단의 빈 저장소 칸에 놓습니다. 저장소가 가득 찼다면, 버릴 타일을 1개 먼저 선택한 후(게임에서 제거) 새로운 타일을 그 칸에 놓습니다.
- 6각형 타일을 자신의 영토에 추가 : 개인 보드의 저장소에 있는 6각형 타일 1개를 선택하여 영토에 놓습니다. 주사위 눈금 칸과 일치하는 칸에 놓아야 하며, 반드시 이전에 놓은 타일과 인접해야합니다. 놓는 타일의 색깔과 놓는 칸의 색깔은 일치해야합니다.
- 상품 팔기 : 주사위의 눈과 일치하는 상품 타일 한 종류를 모두 팔 수 있습니다. 상품의 개수와 상관 없이 실버링 1개를 받으며, 판 상품의 개수 * 플레이어의 수만큼 점수를 받게 됩니다.
- 일꾼 받기 : 주사위의 눈금과 상관없이 일꾼을 2개 받을 수 있습니다.
- 추가적으로 2 실버링을 지불하면 중앙에 있는 타일을 가져올 수 있습니다. 이 액션은 라운드에 한번까지 밖에 사용하지 못합니다.

---

## 타일의 종류
- 기본적으로 효과는 저장소에서 개인 보드에 배치할 때 효과가 발동됩니다.

### 성
- 이 타일을 영지에 놓으면 원하는 눈의 주사위 1개를 더 갖고 있는 것처럼 즉시 추가 액션을 수행합니다.

### 광산
- 각 페이즈가 종료될 때 영지에 있는 광산마다 실버 코인 1개를 받습니다.

### 선박
- 이 타일을 놓으면 턴 순서 토큰을 앞으로 옮기고 원하는 눈금 칸 하나에서 상품을 모두 받습니다.

### 동물 타일
- 연두색입니다.
- 닭, 양, 소, 돼지가 있으며, 동물사이에 점수 차이는 없습니다.
- 플레이어가 동물 타일을 영토에 놓을 때마다 즉시 점수를 얻습니다. 각 타일에는 동물이 2~4마리 그려져 있으며, 플레이어는 나와있는 동물 수 만큼 점수르 얻습니다.
- 타일끼리 연결은 안되어도 상관없지만, 구역이 다르다면 같은 동물이라도 따로 취급합니다.

### 건물 타일
- 베이지색입니다.
- 한 구역 안에서 같은 건물 타일을 놓을 수 없습니다.
  - 창고 : 상품을 판매합니다.
  - 목수의 작업장 : 건물 타일을 하나 가져옵니다.
  - 교회 : 광산, 지식, 성 타일 중 하나를 가져옵니다.
  - 시장 : 선박, 동물 타일 중 하나를 가져옵니다.
  - 하숙집 : 일꾼 타일 4개를 받습니다.
  - 은행 : 2실버링을 받습니다.
  - 시청 : 자신의 창고에 있는 타일을 개인 소유의 땅 위에 놓을 수 있습니다.
  - 망루 : 4점을 얻습니다.

### 지식 타일
- 특수효과 타일입니다. 총 26종류가 있습니다.
  - 1  : 각 도시에 한 종류의 건물만 놓을 수 있다는 규칙을 무시 할 수 있습니다.
  - 2  : 각 페이즈가 종료 되었을때 광산으로 받을 수 있는 실버링 외에, 일반 공급처에서 일꾼 타일을 1개 받습니다.
  - 3  : 상품을 판매 할 때마다, 1실버링 대신 2실버링을 받습니다.
  - 4  : 상품을 판매할 때마다 일꾼타일을 1개를 추가로 받습니다.
  - 5  : 선박을 영토에 놓을 때, 한곳이 아닌, 인접한 두 상품 칸에서 상품 타일을 가져와 자신의 상품 저장소에 놓습니다.
  - 6  : 중앙의 검은색 칸 뿐만 아니라 다른 여섯 눈금 칸에서도 구매할 수 있습니다.
  - 7  : 새로운 동물 타일을 추가할 때, 점수 계산에 사용되는 각 동물 타일마다 승점을 1점씩 더 받습니다.
  - 8  : 알꾼 타일을 지불할 때마다 굴린 주사위에 +-2를 할 수 있습니다.
  - 9  : 건물 배치에 사용한 모든 주사위 굴림에 +-1을 할 수 있습니다.
  - 10 : 선박 또는 또는 동물 타일 배치에 사용한 모든 굴림에 +-1을 할 수 있습니다.
  - 11 : 성, 광산 또는 지식 타일 배치에 사용한 모든 주사위 굴림에 +-1을 할 수 있습니다.
  - 12 : 게임 보드에서 6각형 타일 1개를 가져오는데 사용한 주사위 굴림에 +-1을 할 수 있습니다.
  - 13 : 일꾼 타일 받기 액션을 선택해서 일꾼 타일 2개를 받는 것 외에 1실버링을 추가로 받습니다.
  - 14 : 일꾼 타일 받기 액션 수행 시 일꾼 타일 2개를 받는 대신 4개를 받습니다.
  - 15 : 게임이 종료 되었을 때, 자신이 판매한 상품 종류마다 3점을 받습니다.
  - 16 : 게임이 종료 되었을 때, 창고마다 4점을 받습니다.
  - 17 : 게임이 종료 되었을 때, 망루마다 4점을 받습니다.
  - 18 : 게임이 종료 되었을 때, 목수의 작업장마다 4점을 받습니다.
  - 19 : 게임이 종료 되었을 때, 교회마다 4점을 받습니다.
  - 20 : 게임이 종료 되었을 때, 시장마다 4점을 받습니다.
  - 21 : 게임이 종료 되었을 때, 하숙집마다 4점을 받습니다.
  - 22 : 게임이 종료 되었을 때, 은행마다 4점을 받습니다.
  - 23 : 게임이 종료 되었을 때, 시청마다 4점을 받습니다.
  - 24 : 게임이 종료 되었을 때, 자신의 영토에 있는 동물의 종류마다 4점을 받습니다.
  - 25 : 게임이 종료 되었을 때, 판매한 상품 타일마다 1점을 받습니다.
  - 26 : 게임이 종료 되었을 때, 보너스 타일마다 2점을 받습니다.

## 구역의 완성
- 개인 보드 판 위에 같은 색깔로 붙어있는 것을 구역이라 합니다. 구역을 모두 꽉 채웠을 경우 점수를 받을 수 있는데, 1)페이즈에 따라 2)구역의 타일 개수에 따라 각각 점수를 받는다.(사실 이 게임은 무슨 액션을 해도 점수를 받게 되어있다. 그래서 100점은 기본이고 잘하는 플레이어는 200점을 손쉽게 넘는다.)
  현재 페이즈에 따라 아래의 수치만큼 점수를 받습니다.
- A-10, B-8, C-6, D-4, E-2
- 구역의 타일 개수에 따른 점수는 다음과 같습니다.
- 1개 - 1점
- 2개 - 3점
- 3개 - 6점
- 4개 - 10점
- 5개 - 15점
- 6개 - 21점
- 7개 - 28점
- 8개 - 36점

--- 

# 과제 진행
- 우선 1인 플레이어를 진행할 수 있도록 틀을 완성하고 규칙을 진행합니다.

## 프로젝트 구조
```angular2html
castlesofburgundy
  ├─ AppMain.java                  # 엔트리 포인트 (콘솔에서 게임 실행)
  │
  ├─ core                          # 게임 진행 / 규칙의 뼈대
  │  ├─ GameContext.java           # 공용 보드, 타일 공급 등 게임 전체 상태
  │  ├─ GameContextFactory.java    # 새 게임 생성 (보드/타일 공급 초기화)
  │  ├─ Phase.java                 # 페이즈(A~E) enum
  │  ├─ RoundManager.java          # 페이즈 내 5라운드 진행 + 보드 리셋/보급
  │  ├─ TurnManager.java           # 주사위 굴리고, 플레이어 액션 메뉴 구성/실행
  │  ├─ PlayerActions.java         # 타일 가져오기/배치, 일꾼 받기 등 도메인 액션
  │  ├─ PlayerSetup.java           # 플레이어 이름/시작 성 위치 입력 및 초기 세팅
  │  ├─ TileSupplier.java          # 타입별 타일 풀 관리 + 무작위 공급
  │  ├─ TileEffectContext.java     # 타일 효과 발동 시 컨텍스트(플레이어, 페이즈, 위치 등)
  │  └─ TilePlacementResult.java   # 타일 효과 결과(추가 행동/점수/일꾼/은화)
  │
  ├─ board                         # 공용 시장 보드(섹션 1~6)
  │  ├─ GameBoardLayout.java       # 각 섹션별 슬롯 타입 정보 (건물/선박/지식/동물/광산/성)
  │  ├─ SectionLayout.java         # 섹션 하나(1~6)의 정적 정의
  │  ├─ BoardSlot.java             # (섹션 번호, 슬롯 index) 값 객체
  │  └─ BoardState.java            # 슬롯 → 실제 타일 배치 상태
  │
  ├─ player                        # 개인 보드 / 저장소 / 플레이어
  │  ├─ PersonalLayout.java        # 개인 보드의 정적 배치(37칸, 타입/주사위 눈 정보)
  │  ├─ PersonalCell.java          # 개인 보드의 칸 정보(id, type, die)
  │  ├─ PersonalGrid.java          # 헥스 맵 인접 정보(이웃 cell 계산)
  │  ├─ PersonalBoard.java         # 타일 배치, 합법 배치 검사, 구역 완성 체크
  │  ├─ Storage.java               # 3칸짜리 개인 저장소
  │  └─ Player.java                # 점수, 일꾼, 은화, 보드/저장소를 가진 플레이어
  │
  ├─ tile                          # 타일 종류
  │  ├─ Tile.java                  # 공통 인터페이스(type, id, onPlaced 효과)
  │  ├─ BaseTile.java              # 기본 구현(효과 없는 일반 타일)
  │  ├─ CastleTile.java            # 성 타일: 배치 시 추가 행동 1회 부여
  │  └─ TileType.java              # CASTLE, SHIP, MINE, ANIMAL, BUILDING, KNOWLEDGE
  │
  └─ view                          # 콘솔 출력(텍스트 UI)
     ├─ GameBoardConsoleView.java  # 시장 보드 출력
     ├─ PlayerConsoleView.java     # 개인 보드/저장소/점수 출력
     └─ AsciiUtils.java            # 색상, 정렬 등 ASCII 유틸
```
## 구현 기능
### 전체 게임 보드판을 구현한다.
- 게임 보드판은 1~6의 섹션이 있으며, 각 섹션은 4개의 타일로 구성된다.
  - 각 섹션의 구역의 타일 타입은 다음과 같다. (2인, 2인, 3인, 4인)
  - 1 : 건물, 선박, 지식, 동물
  - 2 : 지식, 성, 건물, 건물
  - 3 : 동물, 건물, 선박, 지식
  - 4 : 선박, 건물, 동물, 광산
  - 5 : 광산, 지식, 건물, 건물
  - 6 : 건물, 동물, 성, 선박
- 5군데의 페이즈 칸이 있다.
- 5군데의 라운드 칸이 있다.
- 게임 보드를 시각화 한다.

#### 각 페이즈가 시작되면 보드판에 타일을 채운다.
1. 빈 보드판(레이아웃만 제공된다.)
2. 각 타입에 맞는 타일을 채운다.

#### 주사위에 맞게 타일을 가져간다.
1. 주사위를 사용한다.
2. 주사위 눈을 통해 타일을 가져간다.

#### 보드판을 시각화한다.

### 개인 보드판을 구현한다.
- 각 개인 보드판은 37개의 정육각형 타일로 구성된다. 각 칸은 타일 타입과, 필요 주사위의 칸으로 구성되어 있다.
- 플레이어의 보드판은 3개의 저장타일을 가진다.
- 플레이어의 타일 배치는 다음과 같다.

#### 초기 성 배치
- 게임이 시작 될 때 플레이어는 아무 성칸 하나에 성을 배치할 수 있다.

#### 타일 배치가능성을 확인한다.
- 각 칸에 배치하기 전에, 저장소에 있어야한다. 저장소에 있는 타일을 주사위의 눈에 맞게 배치할 수 있다.
- 이때 배치할 타일의 인접한 칸에 최소한 하나의 타일이 있어야한다.
- 놓고자하는 타일의 타입이 일치하여야한다.

#### 개인 저장소를 구현한다.
- 저장소는 3칸으로 구성된다.
- 가져온 타일은 저장소에 배치된다.

#### 상품 판매칸을 구현한다(추후 고려)
#### 보드판을 시각화한다.


### 플레이어의 액션을 구현한다.
- 각 플레이어는 주사위를 두개 굴려서, 이를 이용해 밑의 액션 중 하나를 취할 수 있다.
1. 플레이어가 전체 타일에서 타일을 하나 가져온다.
2. 플레이어가 저장소에 있는 타일을 배치한다.
3. 일꾼 두개를 받는다.

### 플레이어의 일꾼을 사용한다.
- 플레이어는 일꾼을 활용하여 주사위 눈을 1만큼 더하거나 뺄 수 있다.
- 중첩해서 사용할 수 있으며, 6에서 1로 변환도 가능하다.
- +4를 하는 것보다 -2를 하는 것이 일꾼 소모를 줄이면서 같은 액션을 취할 수 있다. 즉 최대 일꾼 소모는 3개이다.

### 게임을 진행한다.
- 각 페이즈는 5개이며, 페이즈가 시작될 때 공용 보드칸의 타일이 전부 채워진다.
- 각 페이즈당 5개의 라운드가 존재하며, 라운드당 플레이어는 동시에 주사위를 굴린다.
- 주사위를 통해 모든 플레이어가 액션을 다하면, 한 라운드가 끝난다.


### 각 구역을 완성하였을 때 점수를 얻는다.
- 완성한 구역에 대해 페이즈와 구역의 크기를 고려하여 점수를 얻는다.
- 개인 보드 판 위에 같은 색깔이 뭉터기로 붙어있는 것을 구역이라 한다. 구역을 모두 꽉 채웠을 경우 점수를 받을 수 있는데, 1)페이즈에 따라 2)구역의 타일 개수에 따라 각각 점수를 받는다.(사실 이 게임은 무슨 액션을 해도 점수를 받게 되어있다. 그래서 100점은 기본이고 잘하는 플레이어는 200점을 손쉽게 넘는다.)
  - 현재 페이즈에 따라 아래의 수치만큼 점수를 받는다. 
    - A-10, B-8, C-6, D-4, E-2 
  - 구역의 타일 개수에 따른 점수는 다음과 같다. 
    - 1개 - 1점, 2개 - 3점, 3개 - 6점, 4개 - 10점, 5개 - 15점, 6개 - 21점, 7개 - 28점, 8개 - 36점

### 성 타일을 놓을 때 추가적인 행동을 한번 더 할 수 있다.
- 주사위 눈금에 상관없이, 타일을 가져오거나 배치할 수 있다.
- 일꾼을 얻는 행동은 제한된다.

## 추후 고려 / 미구현
- 상품 타일 / 상품 판매 액션의 상세 구현 
- 선박, 광산, 건물, 지식, 동물 타일의 개별 효과 
- 멀티 플레이(2인 이상) 진행, 턴 순서 트랙, 중앙 시장(검은 타일) 등
- 저장소 타일 제거 기능
- 제일 먼저 타일의 종류를 모두 채운 경우 보너스 점수 추가
- 주사위 순서 선택